from copy import deepcopy
from ep_bolfi.utility.preprocessing import SubstitutionDict
from math import exp, log


def electrode_length(par):
    return par["Current collector perpendicular area [m2]"]**0.5


def cell_volume(par):
    return (
        par["Negative electrode thickness [m]"]
        + par["Separator thickness [m]"]
        + par["Positive electrode thickness [m]"]
    ) * par["Current collector perpendicular area [m2]"]


def c_max(par):
    return (
        3600 * par["Nominal cell capacity [A.h]"] / (
            (1 - par["Positive electrode porosity"])
            * par["Positive electrode thickness [m]"]
            * par["Current collector perpendicular area [m2]"]
            * 96485.33212
        )
    )


def c_init(par):
    return par["Positive electrode SOC"] * c_max(par)


def eff_surf_area(par):
    return (
        3 * (1 - par["Positive electrode porosity"])
        / par["Positive particle radius [m]"]
    )


def sep_brugg(par):
    return (
        -log(par["Separator MacMullin number"])
        / log(par["Separator porosity"])
    )


def OCV_monolayer_17_microns(SOC):
    return (
        (SOC < 0.006015075376884422) * ((
            4327.768022488337 * SOC
            + -70.21489642345898) * SOC
            + 4.791466455864839)
        + (SOC >= 0.006015075376884422) * (SOC < 0.011030150753768845) * ((
            866.6187041254234 * SOC
            + -28.576748342249516) * SOC
            + 4.666238156233664)
        + (SOC >= 0.011030150753768845) * (SOC < 0.02106030150753769) * ((
            205.0113975043605 * SOC
            + -13.9814916785989) * SOC
            + 4.585744215588657)
        + (SOC >= 0.02106030150753769) * (SOC < 0.03610552763819096) * ((
            71.99050034119864 * SOC
            + -8.378571276480159) * SOC
            + 4.52674461909298)
        + (SOC >= 0.03610552763819096) * (SOC < 0.06619597989949749) * ((
            20.874853114468806 * SOC
            + -4.687456449102825) * SOC
            + 4.460109794885175)
        + (SOC >= 0.06619597989949749) * (SOC < 0.09628643216080401) * ((
            6.878569070234789 * SOC
            + -2.834460974583237) * SOC
            + 4.398779369292598)
        + (SOC >= 0.09628643216080401) * (SOC < 0.12637688442211056) * ((
            4.41457838775159 * SOC
            + -2.3599632311958203) * SOC
            + 4.375935521903028)
        + (SOC >= 0.12637688442211056) * (SOC < 0.19157286432160803) * ((
            1.3772369744866069 * SOC
            + -1.5922637417263275) * SOC
            + 4.327425787077231)
        + (SOC >= 0.19157286432160803) * (SOC < 0.2517537688442211) * ((
            -0.13856336977755745 * SOC
            + -1.0114913143456477) * SOC
            + 4.271795668361062)
        + (SOC >= 0.2517537688442211) * (SOC < 0.31694974874371856) * ((
            -0.49515533896368424 * SOC
            + -0.8319445699812036) * SOC
            + 4.249194883572354)
        + (SOC >= 0.31694974874371856) * (SOC < 0.37713065326633166) * ((
            1.7202387822025003 * SOC
            + -2.2362817901251333) * SOC
            + 4.471747048110359)
        + (SOC >= 0.37713065326633166) * (SOC < 0.44232663316582915) * ((
            2.3146820951566838 * SOC
            + -2.6846473800134163) * SOC
            + 4.556293252018747)
        + (SOC >= 0.44232663316582915) * (SOC < 0.5025075376884423) * ((
            1.1823279856151316 * SOC
            + -1.682906618363461) * SOC
            + 4.334744942815917)
        + (SOC >= 0.5025075376884423) * (SOC < 0.5677035175879397) * ((
            0.5976410928342943 * SOC
            + -1.0952874767435787) * SOC
            + 4.187103418838845)
        + (SOC >= 0.5677035175879397) * (SOC < 0.6278844221105527) * ((
            0.34566169395441193 * SOC
            + -0.809188294535943) * SOC
            + 4.1058936627797635)
        + (SOC >= 0.6278844221105527) * (SOC < 0.7532613065326633) * ((
            -0.05691285989067296 * SOC
            + -0.30364771234104637) * SOC
            + 3.947183134627352)
        + (SOC >= 0.7532613065326633) * (SOC < 0.8184572864321608) * ((
            -0.5616711739030507 * SOC
            + 0.4567821018514451) * SOC
            + 3.660781956944817)
        + (SOC >= 0.8184572864321608) * (SOC < 0.8786381909547738) * ((
            -1.1586957303367171 * SOC
            + 1.4340602986355862) * SOC
            + 3.2608517264302463)
        + (SOC >= 0.8786381909547738) * (SOC < 0.9087286432160804) * ((
            -3.023761075088487 * SOC
            + 4.711495579685561) * SOC
            + 1.8210118232734658)
        + (SOC >= 0.9087286432160804) * (SOC < 0.938819095477387) * ((
            -4.426761993694981 * SOC
            + 7.261389822078854) * SOC
            + 0.6624308556570213)
        + (SOC >= 0.938819095477387) * (SOC < 0.9689095477386934) * ((
            -15.156394830280078 * SOC
            + 27.407758210973043) * SOC
            + -8.794466818351793)
        + (SOC >= 0.9689095477386934) * (SOC < 0.9839547738693467) * ((
            -57.37699159733711 * SOC
            + 109.22363684862648) * SOC
            + -48.430559802676726)
        + (SOC >= 0.9839547738693467) * (SOC < 0.9939849246231156) * ((
            -278.97535136616716 * SOC
            + 545.3091648009504) * SOC
            + -262.97477832468576)
        + (SOC >= 0.9939849246231156) * ((
            -3112.093210115854 * SOC
            + 6177.462047356385) * SOC
            + -3062.1123075410433)
    )


def derivative_OCV_monolayer_17_microns(SOC):
    return (
        (SOC < 0.006015075376884422) * (
            8655.536044976674 * SOC
            + -70.21489642345898)
        + (SOC >= 0.006015075376884422) * (SOC < 0.011030150753768845) * (
            1733.2374082508468 * SOC
            + -28.576748342249516)
        + (SOC >= 0.011030150753768845) * (SOC < 0.02106030150753769) * (
            410.022795008721 * SOC
            + -13.9814916785989)
        + (SOC >= 0.02106030150753769) * (SOC < 0.03610552763819096) * (
            143.98100068239728 * SOC
            + -8.378571276480159)
        + (SOC >= 0.03610552763819096) * (SOC < 0.06619597989949749) * (
            41.74970622893761 * SOC
            + -4.687456449102825)
        + (SOC >= 0.06619597989949749) * (SOC < 0.09628643216080401) * (
            13.757138140469579 * SOC
            + -2.834460974583237)
        + (SOC >= 0.09628643216080401) * (SOC < 0.12637688442211056) * (
            8.82915677550318 * SOC
            + -2.3599632311958203)
        + (SOC >= 0.12637688442211056) * (SOC < 0.19157286432160803) * (
            2.7544739489732137 * SOC
            + -1.5922637417263275)
        + (SOC >= 0.19157286432160803) * (SOC < 0.2517537688442211) * (
            -0.2771267395551149 * SOC
            + -1.0114913143456477)
        + (SOC >= 0.2517537688442211) * (SOC < 0.31694974874371856) * (
            -0.9903106779273685 * SOC
            + -0.8319445699812036)
        + (SOC >= 0.31694974874371856) * (SOC < 0.37713065326633166) * (
            3.4404775644050005 * SOC
            + -2.2362817901251333)
        + (SOC >= 0.37713065326633166) * (SOC < 0.44232663316582915) * (
            4.6293641903133675 * SOC
            + -2.6846473800134163)
        + (SOC >= 0.44232663316582915) * (SOC < 0.5025075376884423) * (
            2.3646559712302633 * SOC
            + -1.682906618363461)
        + (SOC >= 0.5025075376884423) * (SOC < 0.5677035175879397) * (
            1.1952821856685887 * SOC
            + -1.0952874767435787)
        + (SOC >= 0.5677035175879397) * (SOC < 0.6278844221105527) * (
            0.6913233879088239 * SOC
            + -0.809188294535943)
        + (SOC >= 0.6278844221105527) * (SOC < 0.7532613065326633) * (
            -0.11382571978134592 * SOC
            + -0.30364771234104637)
        + (SOC >= 0.7532613065326633) * (SOC < 0.8184572864321608) * (
            -1.1233423478061013 * SOC
            + 0.4567821018514451)
        + (SOC >= 0.8184572864321608) * (SOC < 0.8786381909547738) * (
            -2.3173914606734343 * SOC
            + 1.4340602986355862)
        + (SOC >= 0.8786381909547738) * (SOC < 0.9087286432160804) * (
            -6.047522150176974 * SOC
            + 4.711495579685561)
        + (SOC >= 0.9087286432160804) * (SOC < 0.938819095477387) * (
            -8.853523987389963 * SOC
            + 7.261389822078854)
        + (SOC >= 0.938819095477387) * (SOC < 0.9689095477386934) * (
            -30.312789660560156 * SOC
            + 27.407758210973043)
        + (SOC >= 0.9689095477386934) * (SOC < 0.9839547738693467) * (
            -114.75398319467422 * SOC
            + 109.22363684862648)
        + (SOC >= 0.9839547738693467) * (SOC < 0.9939849246231156) * (
            -557.9507027323343 * SOC
            + 545.3091648009504)
        + (SOC >= 0.9939849246231156) * (
            -6224.186420231708 * SOC
            + 6177.462047356385)
    )


def OCV_porous_42_microns(SOC):
    return (
        (SOC < 0.006015075376884422) * ((
            5177.783933267361 * SOC
            + -83.33697942297869) * SOC
            + 4.942932375182647)
        + (SOC >= 0.006015075376884422) * (SOC < 0.011030150753768845) * ((
            972.3053138390751 * SOC
            + -32.74443763950444) * SOC
            + 4.7907733990147605)
        + (SOC >= 0.011030150753768845) * (SOC < 0.02106030150753769) * ((
            254.3341569552358 * SOC
            + -16.90577744493163) * SOC
            + 4.703421994172834)
        + (SOC >= 0.02106030150753769) * (SOC < 0.03610552763819096) * ((
            78.56027100125903 * SOC
            + -9.502075374246829) * SOC
            + 4.625459895232533)
        + (SOC >= 0.03610552763819096) * (SOC < 0.05115075376884422) * ((
            30.806688928820222 * SOC
            + -6.0537388195685935) * SOC
            + 4.5632078898421735)
        + (SOC >= 0.05115075376884422) * (SOC < 0.06619597989949749) * ((
            20.462287352613203 * SOC
            + -4.9954909437476545) * SOC
            + 4.536142801580912)
        + (SOC >= 0.06619597989949749) * (SOC < 0.09628643216080401) * ((
            8.979508757493477 * SOC
            + -3.4752633816018488) * SOC
            + 4.485826325007682)
        + (SOC >= 0.09628643216080401) * (SOC < 0.12637688442211056) * ((
            5.022566084589471 * SOC
            + -2.713263597124353) * SOC
            + 4.449141204730351)
        + (SOC >= 0.12637688442211056) * (SOC < 0.19157286432160803) * ((
            1.734345170779477 * SOC
            + -1.8821533683663318) * SOC
            + 4.396624644069469)
        + (SOC >= 0.19157286432160803) * (SOC < 0.2517537688442211) * ((
            -0.02434527129776143 * SOC
            + -1.2083186374788113) * SOC
            + 4.332080419331714)
        + (SOC >= 0.2517537688442211) * (SOC < 0.31694974874371856) * ((
            -0.5164460376261104 * SOC
            + -0.960542192330081) * SOC
            + 4.300891092383221)
        + (SOC >= 0.31694974874371856) * (SOC < 0.37713065326633166) * ((
            2.1073903770014795 * SOC
            + -2.6237907770519087) * SOC
            + 4.564474202896157)
        + (SOC >= 0.37713065326633166) * (SOC < 0.44232663316582915) * ((
            2.8048070796405113 * SOC
            + -3.149825210382005) * SOC
            + 4.663666057637371)
        + (SOC >= 0.44232663316582915) * (SOC < 0.5025075376884423) * ((
            1.3181215064059302 * SOC
            + -1.8346239620119604) * SOC
            + 4.372791787573803)
        + (SOC >= 0.5025075376884423) * (SOC < 0.5677035175879397) * ((
            0.6754236712576471 * SOC
            + -1.18870294877604) * SOC
            + 4.2105016986225365)
        + (SOC >= 0.5677035175879397) * (SOC < 0.6278844221105527) * ((
            0.35659474200969044 * SOC
            + -0.8267023394902253) * SOC
            + 4.1077471889923345)
        + (SOC >= 0.6278844221105527) * (SOC < 0.7532613065326633) * ((
            -0.03396650940428003 * SOC
            + -0.336247688204395) * SOC
            + 3.953772771345399)
        + (SOC >= 0.7532613065326633) * (SOC < 0.7883668341708543) * ((
            -0.7185926504641884 * SOC
            + 0.6951570747978622) * SOC
            + 3.5653141216738504)
        + (SOC >= 0.7883668341708543) * (SOC < 0.8184572864321608) * ((
            -0.3241856717609153 * SOC
            + 0.07328231244810013) * SOC
            + 3.81044684049607)
        + (SOC >= 0.8184572864321608) * (SOC < 0.8786381909547738) * ((
            -1.2648799442783911 * SOC
            + 1.6131184757409756) * SOC
            + 3.1803017766164885)
        + (SOC >= 0.8786381909547738) * (SOC < 0.9087286432160804) * ((
            -3.01427933808759 * SOC
            + 4.6872967130098) * SOC
            + 1.829756574083376)
        + (SOC >= 0.9087286432160804) * (SOC < 0.938819095477387) * ((
            -4.639934862316295 * SOC
            + 7.6418561907471485) * SOC
            + 0.4873101613311519)
        + (SOC >= 0.938819095477387) * (SOC < 0.9689095477386934) * ((
            -16.08006683322219 * SOC
            + 29.12228488888377) * SOC
            + -9.595808159094759)
        + (SOC >= 0.9689095477386934) * (SOC < 0.9839547738693467) * ((
            -62.99048692389624 * SOC
            + 120.02619271745425) * SOC
            + -53.63464027002556)
        + (SOC >= 0.9839547738693467) * (SOC < 0.9939849246231156) * ((
            -324.8364689617665 * SOC
            + 635.3154008067868) * SOC
            + -307.1452783814493)
        + (SOC >= 0.9939849246231156) * ((
            -4148.740333427573 * SOC
            + 8237.12098978099) * SOC
            + -4085.1853560594755)
    )


def derivative_OCV_porous_42_microns(SOC):
    return (
        (SOC < 0.006015075376884422) * (
            10355.567866534722 * SOC
            + -83.33697942297869)
        + (SOC >= 0.006015075376884422) * (SOC < 0.011030150753768845) * (
            1944.6106276781502 * SOC
            + -32.74443763950444)
        + (SOC >= 0.011030150753768845) * (SOC < 0.02106030150753769) * (
            508.6683139104716 * SOC
            + -16.90577744493163)
        + (SOC >= 0.02106030150753769) * (SOC < 0.03610552763819096) * (
            157.12054200251805 * SOC
            + -9.502075374246829)
        + (SOC >= 0.03610552763819096) * (SOC < 0.05115075376884422) * (
            61.613377857640444 * SOC
            + -6.0537388195685935)
        + (SOC >= 0.05115075376884422) * (SOC < 0.06619597989949749) * (
            40.924574705226405 * SOC
            + -4.9954909437476545)
        + (SOC >= 0.06619597989949749) * (SOC < 0.09628643216080401) * (
            17.959017514986954 * SOC
            + -3.4752633816018488)
        + (SOC >= 0.09628643216080401) * (SOC < 0.12637688442211056) * (
            10.045132169178942 * SOC
            + -2.713263597124353)
        + (SOC >= 0.12637688442211056) * (SOC < 0.19157286432160803) * (
            3.468690341558954 * SOC
            + -1.8821533683663318)
        + (SOC >= 0.19157286432160803) * (SOC < 0.2517537688442211) * (
            -0.04869054259552286 * SOC
            + -1.2083186374788113)
        + (SOC >= 0.2517537688442211) * (SOC < 0.31694974874371856) * (
            -1.0328920752522208 * SOC
            + -0.960542192330081)
        + (SOC >= 0.31694974874371856) * (SOC < 0.37713065326633166) * (
            4.214780754002959 * SOC
            + -2.6237907770519087)
        + (SOC >= 0.37713065326633166) * (SOC < 0.44232663316582915) * (
            5.609614159281023 * SOC
            + -3.149825210382005)
        + (SOC >= 0.44232663316582915) * (SOC < 0.5025075376884423) * (
            2.6362430128118604 * SOC
            + -1.8346239620119604)
        + (SOC >= 0.5025075376884423) * (SOC < 0.5677035175879397) * (
            1.3508473425152943 * SOC
            + -1.18870294877604)
        + (SOC >= 0.5677035175879397) * (SOC < 0.6278844221105527) * (
            0.7131894840193809 * SOC
            + -0.8267023394902253)
        + (SOC >= 0.6278844221105527) * (SOC < 0.7532613065326633) * (
            -0.06793301880856006 * SOC
            + -0.336247688204395)
        + (SOC >= 0.7532613065326633) * (SOC < 0.7883668341708543) * (
            -1.4371853009283768 * SOC
            + 0.6951570747978622)
        + (SOC >= 0.7883668341708543) * (SOC < 0.8184572864321608) * (
            -0.6483713435218306 * SOC
            + 0.07328231244810013)
        + (SOC >= 0.8184572864321608) * (SOC < 0.8786381909547738) * (
            -2.5297598885567822 * SOC
            + 1.6131184757409756)
        + (SOC >= 0.8786381909547738) * (SOC < 0.9087286432160804) * (
            -6.02855867617518 * SOC
            + 4.6872967130098)
        + (SOC >= 0.9087286432160804) * (SOC < 0.938819095477387) * (
            -9.27986972463259 * SOC
            + 7.6418561907471485)
        + (SOC >= 0.938819095477387) * (SOC < 0.9689095477386934) * (
            -32.16013366644438 * SOC
            + 29.12228488888377)
        + (SOC >= 0.9689095477386934) * (SOC < 0.9839547738693467) * (
            -125.98097384779248 * SOC
            + 120.02619271745425)
        + (SOC >= 0.9839547738693467) * (SOC < 0.9939849246231156) * (
            -649.672937923533 * SOC
            + 635.3154008067868)
        + (SOC >= 0.9939849246231156) * (
            -8297.480666855146 * SOC
            + 8237.12098978099)
    )


def OCV_porous_80_microns(SOC):
    return (
        (SOC < 0.006015075376884422) * ((
            5252.06550238216 * SOC
            + -85.540902199796) * SOC
            + 4.981355681431279)
        + (SOC >= 0.006015075376884422) * (SOC < 0.011030150753768845) * ((
            1078.2838141241373 * SOC
            + -35.32967927673212) * SOC
            + 4.8303435361073905)
        + (SOC >= 0.011030150753768845) * (SOC < 0.02106030150753769) * ((
            253.07691926793268 * SOC
            + -17.12536637010527) * SOC
            + 4.729945378242956)
        + (SOC >= 0.02106030150753769) * (SOC < 0.03610552763819096) * ((
            83.5435749589742 * SOC
            + -9.984519676649654) * SOC
            + 4.654751186051314)
        + (SOC >= 0.03610552763819096) * (SOC < 0.05115075376884422) * ((
            31.31914813435651 * SOC
            + -6.213338704439593) * SOC
            + 4.586670946640943)
        + (SOC >= 0.05115075376884422) * (SOC < 0.06619597989949749) * ((
            21.444391680566696 * SOC
            + -5.203136232649513) * SOC
            + 4.560834637695333)
        + (SOC >= 0.06619597989949749) * (SOC < 0.09628643216080401) * ((
            9.357225379113515 * SOC
            + -3.602892597583832) * SOC
            + 4.507869789944781)
        + (SOC >= 0.09628643216080401) * (SOC < 0.12637688442211056) * ((
            5.197879662078549 * SOC
            + -2.8019154791506367) * SOC
            + 4.469308175456582)
        + (SOC >= 0.12637688442211056) * (SOC < 0.19157286432160803) * ((
            1.880057766203663 * SOC
            + -1.9633234906144423) * SOC
            + 4.416318854050315)
        + (SOC >= 0.19157286432160803) * (SOC < 0.2517537688442211) * ((
            -0.021088729886969304 * SOC
            + -1.234907331112197) * SOC
            + 4.346546469003318)
        + (SOC >= 0.2517537688442211) * (SOC < 0.31694974874371856) * ((
            -0.36835446293730456 * SOC
            + -1.0600564169404265) * SOC
            + 4.32453678068903)
        + (SOC >= 0.31694974874371856) * (SOC < 0.34704020100502514) * ((
            1.105221645227175 * SOC
            + -1.9941555714156038) * SOC
            + 4.472568026845352)
        + (SOC >= 0.34704020100502514) * (SOC < 0.37713065326633166) * ((
            2.8107099460094105 * SOC
            + -3.1779015768458976) * SOC
            + 4.677971752676939)
        + (SOC >= 0.37713065326633166) * (SOC < 0.44232663316582915) * ((
            2.7632529419825573 * SOC
            + -3.142106594984284) * SOC
            + 4.6712220602305194)
        + (SOC >= 0.44232663316582915) * (SOC < 0.5025075376884423) * ((
            1.4898241747671932 * SOC
            + -2.015563676626641) * SOC
            + 4.422072092133504)
        + (SOC >= 0.5025075376884423) * (SOC < 0.5677035175879397) * ((
            0.6760747910667533 * SOC
            + -1.197733278429098) * SOC
            + 4.2165891223109355)
        + (SOC >= 0.5677035175879397) * (SOC < 0.6278844221105527) * ((
            0.4031517664107582 * SOC
            + -0.8878545561732949) * SOC
            + 4.128629501985841)
        + (SOC >= 0.6278844221105527) * (SOC < 0.7532613065326633) * ((
            -0.0423022776961659 * SOC
            + -0.3284672460513889) * SOC
            + 3.9530142130099506)
        + (SOC >= 0.7532613065326633) * (SOC < 0.8184572864321608) * ((
            -0.5695955926386773 * SOC
            + 0.4659120566277579) * SOC
            + 3.6538266173006377)
        + (SOC >= 0.8184572864321608) * (SOC < 0.8786381909547738) * ((
            -1.1877907988101697 * SOC
            + 1.4778447984845116) * SOC
            + 3.239714754324609)
        + (SOC >= 0.8786381909547738) * (SOC < 0.9087286432160804) * ((
            -3.1857782388037776 * SOC
            + 4.988860938137805) * SOC
            + 1.6972583196459254)
        + (SOC >= 0.9087286432160804) * (SOC < 0.938819095477387) * ((
            -4.599262662306728 * SOC
            + 7.55780850289193) * SOC
            + 0.5300202021401219)
        + (SOC >= 0.938819095477387) * (SOC < 0.9689095477386934) * ((
            -16.67280669139791 * SOC
            + 30.22755587208667) * SOC
            + -10.11137565778472)
        + (SOC >= 0.9689095477386934) * (SOC < 0.9839547738693467) * ((
            -64.08420926520012 * SOC
            + 122.10227712296182) * SOC
            + -54.620522965688)
        + (SOC >= 0.9839547738693467) * (SOC < 0.9939849246231156) * ((
            -352.042942590193 * SOC
            + 688.7790177879579) * SOC
            + -333.4126650747057)
        + (SOC >= 0.9939849246231156) * ((
            -4527.655695340203 * SOC
            + 8989.771272383106) * SOC
            + -4458.943245315109)
    )


def derivative_OCV_porous_80_microns(SOC):
    return (
        (SOC < 0.006015075376884422) * (
            10504.13100476432 * SOC
            + -85.540902199796)
        + (SOC >= 0.006015075376884422) * (SOC < 0.011030150753768845) * (
            2156.5676282482746 * SOC
            + -35.32967927673212)
        + (SOC >= 0.011030150753768845) * (SOC < 0.02106030150753769) * (
            506.15383853586536 * SOC
            + -17.12536637010527)
        + (SOC >= 0.02106030150753769) * (SOC < 0.03610552763819096) * (
            167.0871499179484 * SOC
            + -9.984519676649654)
        + (SOC >= 0.03610552763819096) * (SOC < 0.05115075376884422) * (
            62.63829626871302 * SOC
            + -6.213338704439593)
        + (SOC >= 0.05115075376884422) * (SOC < 0.06619597989949749) * (
            42.88878336113339 * SOC
            + -5.203136232649513)
        + (SOC >= 0.06619597989949749) * (SOC < 0.09628643216080401) * (
            18.71445075822703 * SOC
            + -3.602892597583832)
        + (SOC >= 0.09628643216080401) * (SOC < 0.12637688442211056) * (
            10.395759324157098 * SOC
            + -2.8019154791506367)
        + (SOC >= 0.12637688442211056) * (SOC < 0.19157286432160803) * (
            3.760115532407326 * SOC
            + -1.9633234906144423)
        + (SOC >= 0.19157286432160803) * (SOC < 0.2517537688442211) * (
            -0.04217745977393861 * SOC
            + -1.234907331112197)
        + (SOC >= 0.2517537688442211) * (SOC < 0.31694974874371856) * (
            -0.7367089258746091 * SOC
            + -1.0600564169404265)
        + (SOC >= 0.31694974874371856) * (SOC < 0.34704020100502514) * (
            2.21044329045435 * SOC
            + -1.9941555714156038)
        + (SOC >= 0.34704020100502514) * (SOC < 0.37713065326633166) * (
            5.621419892018821 * SOC
            + -3.1779015768458976)
        + (SOC >= 0.37713065326633166) * (SOC < 0.44232663316582915) * (
            5.526505883965115 * SOC
            + -3.142106594984284)
        + (SOC >= 0.44232663316582915) * (SOC < 0.5025075376884423) * (
            2.9796483495343864 * SOC
            + -2.015563676626641)
        + (SOC >= 0.5025075376884423) * (SOC < 0.5677035175879397) * (
            1.3521495821335066 * SOC
            + -1.197733278429098)
        + (SOC >= 0.5677035175879397) * (SOC < 0.6278844221105527) * (
            0.8063035328215165 * SOC
            + -0.8878545561732949)
        + (SOC >= 0.6278844221105527) * (SOC < 0.7532613065326633) * (
            -0.0846045553923318 * SOC
            + -0.3284672460513889)
        + (SOC >= 0.7532613065326633) * (SOC < 0.8184572864321608) * (
            -1.1391911852773546 * SOC
            + 0.4659120566277579)
        + (SOC >= 0.8184572864321608) * (SOC < 0.8786381909547738) * (
            -2.3755815976203394 * SOC
            + 1.4778447984845116)
        + (SOC >= 0.8786381909547738) * (SOC < 0.9087286432160804) * (
            -6.371556477607555 * SOC
            + 4.988860938137805)
        + (SOC >= 0.9087286432160804) * (SOC < 0.938819095477387) * (
            -9.198525324613456 * SOC
            + 7.55780850289193)
        + (SOC >= 0.938819095477387) * (SOC < 0.9689095477386934) * (
            -33.34561338279582 * SOC
            + 30.22755587208667)
        + (SOC >= 0.9689095477386934) * (SOC < 0.9839547738693467) * (
            -128.16841853040023 * SOC
            + 122.10227712296182)
        + (SOC >= 0.9839547738693467) * (SOC < 0.9939849246231156) * (
            -704.085885180386 * SOC
            + 688.7790177879579)
        + (SOC >= 0.9939849246231156) * (
            -9055.311390680406 * SOC
            + 8989.771272383106)
    )


parameters = SubstitutionDict({
    ########################################
    # Placeholders for unknown parameters. #
    ########################################
    "Positive particle diffusivity [m2.s-1]": 1e-15,
    "Positive electrode exchange-current density [A.m-2]": 1.0,
    "Positive electrode double-layer capacity [F.m-2]": 0.24,
    "Positive electrode Bruggeman coefficient": 1.5,
    "Thermodynamic factor": 2,
    ###################################################
    # Lithium-metal electrode parameters from Xu2019. #
    ###################################################
    "Exchange-current density for lithium metal electrode [A.m-2]": (
        lambda c_e, c_Li, T: 3.5e-8 * 96458.33212 * c_Li**0.7 + c_e**0.3
    ),
    "Lithium metal partial molar volume [m3.mol-1]": 1.3e-05,
    ########################################################
    # Parameters taken from the corresponding Excel sheet. #
    # Note that these are for MEL; substitute as needed.   #
    ########################################################
    "Electrolyte diffusivity [m2.s-1]": 5.66e-10,
    "Cation transference number": 0.4665,
    "Positive electrode thickness [m]": 1.7e-5,
    "Positive particle radius [m]": 5.22e-6,
    "Current collector perpendicular area [m2]": 0.000254469,
    "Positive electrode conductivity [S.m-1]": 0.5,  # 100
    "Electrolyte conductivity [S.m-1]": 0.59,
    "Positive electrode porosity": 0.75,
    "Typical electrolyte concentration [mol.m-3]": 250,
    "Initial concentration in electrolyte [mol.m-3]": 250,
    "Lower voltage cut-off [V]": 3.4,
    "Upper voltage cut-off [V]": 4.3,
    "Reference temperature [K]": 298.15,
    "Ambient temperature [K]": 298.15,
    "Initial temperature [K]": 298.15,
    "Nominal cell capacity [A.h]": 7e-4,
    "Positive electrode OCP [V]": OCV_monolayer_17_microns,
    "Positive electrode OCP derivative by SOC [V]": (
        derivative_OCV_monolayer_17_microns
    ),
    #####################################
    # Preliminary separator properties. #
    #####################################
    "Separator thickness [m]": 176e-6,
    "Separator MacMullin number": 3.472,
    "Separator porosity": 0.63,
    ###################################################################
    # Dummy parameters for simulations with a negative electrode.     #
    # These make the negative electrode have approximately no effect. #
    ###################################################################
    "Negative particle diffusivity [m2.s-1]": 1e-8,
    "Negative electrode thickness [m]": 1e-8,
    # This is just the inverse of the thickness for a planar electrode.
    "Negative electrode surface area to volume ratio [m-1]": 1e8,
    "Negative particle radius [m]": 1e-4,
    "Maximum concentration in negative electrode [mol.m-3]": 1,
    "Negative electrode conductivity [S.m-1]": 1e3,
    "Negative electrode OCP [V]": 1e-6,
    "Negative electrode OCP derivative by SOC [V]": 0,
    "Negative electrode Bruggeman coefficient (electrolyte)": 1,
    "Negative electrode Bruggeman coefficient (electrode)": 1,
    "Negative electrode porosity": 0.99,
    "Negative electrode exchange-current density [A.m-2]": 1000,
    "Initial concentration in negative electrode [mol.m-3]": 1,
    "Negative electrode double-layer capacity [F.m-2]": 0.6,
    #################################
    # Boilerplate PyBaMM variables. #
    #################################
    "Typical current [A]": 1,
    "Current function [A]": 0,
    "Negative electrode OCP entropic change [V.K-1]": 0,
    "Negative electrode OCP entropic change partial derivative by SOC [V.K-1]":
        0,
    # Not relevant, as we only ever evaluate the model at reference T.
    "Positive electrode OCP entropic change [V.K-1]": 0,
    "Positive electrode OCP entropic change partial derivative by SOC [V.K-1]":
        0,
    "Number of electrodes connected in parallel to make a cell": 1,
    "Number of cells connected in series to make a battery": 1,
    "Negative electrode anodic charge-transfer coefficient": 0.5,
    "Negative electrode cathodic charge-transfer coefficient": 0.5,
    "Positive electrode anodic charge-transfer coefficient": 0.5,
    "Positive electrode cathodic charge-transfer coefficient": 0.5,
    "Negative electrode active material volume fraction": 1,
    "Positive electrode active material volume fraction": 1,
    "Negative electrode electrons in reaction": 1,
    "Positive electrode electrons in reaction": 1,
},
    substitutions={
    "Electrode width [m]": electrode_length,
    "Electrode height [m]": electrode_length,
    "Cell volume [m3]": cell_volume,
    "Positive electrode Bruggeman coefficient (electrolyte)": (
        "Positive electrode Bruggeman coefficient"
    ),
    "Positive electrode Bruggeman coefficient (electrode)": (
        "Positive electrode Bruggeman coefficient"
    ),
    "Separator Bruggeman coefficient": sep_brugg,
    "Separator Bruggeman coefficient (electrolyte)": (
        "Separator Bruggeman coefficient"
    ),
    "Separator Bruggeman coefficient (electrode)": (
        "Separator Bruggeman coefficient"
    ),
    "Maximum concentration in positive electrode [mol.m-3]": c_max,
    "Initial concentration in positive electrode [mol.m-3]": c_init,
    "Positive electrode surface area to volume ratio [m-1]": eff_surf_area,
})


def get_parameters_for_cell(cell_name):
    completed_parameters = deepcopy(parameters)
    match cell_name:
        case "monolayer_17_microns":
            completed_parameters.update({
                "Nominal cell capacity [A.h]": 7e-4,
                "Positive electrode thickness [m]": 1.7e-5,
                "Positive electrode porosity": 0.75,
                "Positive electrode OCP [V]": OCV_monolayer_17_microns,
                "Positive electrode OCP derivative by SOC [V]": (
                    derivative_OCV_monolayer_17_microns
                ),
            })
        case "porous_42_microns":
            completed_parameters.update({
                "Nominal cell capacity [A.h]": 4e-3,
                "Positive electrode thickness [m]": 4.2e-5,
                "Positive electrode porosity": 0.3102,
                "Positive electrode OCP [V]": OCV_porous_42_microns,
                "Positive electrode OCP derivative by SOC [V]": (
                    derivative_OCV_porous_42_microns
                ),
            })
        case "porous_80_microns":
            completed_parameters.update({
                "Nominal cell capacity [A.h]": 8e-3,
                "Positive electrode thickness [m]": 8e-5,
                "Positive electrode porosity": 0.271,
                "Positive electrode OCP [V]": OCV_porous_80_microns,
                "Positive electrode OCP derivative by SOC [V]": (
                    derivative_OCV_porous_80_microns
                ),
            })
        case _:
            raise ValueError(
                "cell_name must be one of 'monolayer_17_microns', "
                "'porous_42_microns', or 'porous_80_microns'."
            )
    return completed_parameters
