"""!@file
Parameter file for the 18650 LG MJ1 3500 cell with a third reference electrode.
"""

from copy import deepcopy

from ep_bolfi.utility.preprocessing import SubstitutionDict
from numpy import exp, log
from pybamm import Parameter

##############################
# Reaction symmetry factors. #
##############################

"""! Anodic symmetry factor at Graphite-SiOx. """
αₙₙ = 0.5
"""! Cathodic symmetry factor at Graphite-SiOx. """
αₚₙ = 0.5
"""! Anodic symmetry factor at NMC. """
αₙₚ = 0.5
"""! Cathodic symmetry factor at NMC. """
αₚₚ = 0.5

#############
# Geometry. #
#############


def sqrt_area(par):
    return par["Current collector perpendicular area [m2]"] ** 0.5


def cell_volume(par):
    return par["Current collector perpendicular area [m2]"] * (
        par["Negative electrode thickness [m]"]
        + par["Separator thickness [m]"]
        + par["Positive electrode thickness [m]"]
    )


###################################################
# Maximum and initial active material lithiation. #
###################################################


def negative_concentration_correction(par):
    return 43.9445 / (
        par["Negative electrode active material volume fraction"]
        * par["Negative electrode thickness [m]"]
        * par["Current collector perpendicular area [m2]"]
        * 96485.33212
    )


def positive_concentration(par):
    # Use the areal capacity of 5.26 mAh/cm². Since it applies to the double-
    # coated current collector, half it.
    return (
        3600.0
        * 26.3  # areal capacity in C/m²
        * par["Current collector perpendicular area [m2]"]
        / 96485.33212  # scale to mol instead of C
    ) / (
        par["Positive electrode active material volume fraction"]
        * par["Positive electrode thickness [m]"]
        * par["Current collector perpendicular area [m2]"]
    )


def placeholder_initial_negative_concentration(par):
    return 0.5 * par["Maximum concentration in negative electrode [mol.m-3]"]


def placeholder_initial_positive_concentration(par):
    return 0.5 * par["Maximum concentration in positive electrode [mol.m-3]"]


####################################
# Active material volume fraction. #
####################################


def negative_volume_fraction(par):
    return 0.93 * (1 - par["Negative electrode porosity"])


def positive_volume_fraction(par):
    return 0.92 * (1 - par["Positive electrode porosity"])


#########################################################################
# Bruggeman coefficients, expressed in terms of path-length tortuosity. #
#########################################################################


def negative_bruggeman(par):
    return 1 - 2 * log(par["Negative electrode tortuosity square"] ** 0.5) / log(
        par["Negative electrode porosity"]
    )


def positive_bruggeman(par):
    return 1 - 2 * log(par["Positive electrode tortuosity square"] ** 0.5) / log(
        par["Positive electrode porosity"]
    )


######################################################################
# Standard relation for 1D+1D models to ensure lithium conservation. #
######################################################################


def negative_effective_surface_area(par):
    return (
        3
        * (1 - par["Negative electrode porosity"])
        / par["Negative particle radius [m]"]
    )


def positive_effective_surface_area(par):
    return (
        3
        * (1 - par["Positive electrode porosity"])
        / par["Positive particle radius [m]"]
    )


##################################
# Open Circuit Potential curves. #
##################################


# Discharge profile - Delithiation direction of the Anode
def _18650_LG_3500_MJ1_Anode_GITT_dch_ohne_EIS_2320__extraction(SOC):
    return (
        (SOC < 0.006015075376884422)
        * ((5008.957495658953 * SOC + -81.88347557587394) * SOC + 1.1056235451272727)
        + (SOC >= 0.006015075376884422)
        * (SOC < 0.011030150753768845)
        * ((1017.5623642237479 * SOC + -33.86639042684935) * SOC + 0.9612103518524422)
        + (SOC >= 0.011030150753768845)
        * (SOC < 0.02106030150753769)
        * ((234.26254027875802 * SOC + -16.58656013982172) * SOC + 0.8659107853197145)
        + (SOC >= 0.02106030150753769)
        * (SOC < 0.03610552763819096)
        * ((81.70919824890336 * SOC + -10.160921381559184) * SOC + 0.7982478405059502)
        + (SOC >= 0.03610552763819096)
        * (SOC < 0.06619597989949749)
        * ((20.66446523763034 * SOC + -5.752816791750165) * SOC + 0.7186693694562571)
        + (SOC >= 0.06619597989949749)
        * (SOC < 0.09628643216080401)
        * ((1.6458973973553839 * SOC + -3.23491132280601) * SOC + 0.6353317595507268)
        + (SOC >= 0.09628643216080401)
        * (SOC < 0.11133165829145729)
        * ((0.4299162758333068 * SOC + -3.0007463552735203) * SOC + 0.6240583049203501)
        + (SOC >= 0.11133165829145729)
        * (SOC < 0.12637688442211056)
        * ((43.272535809588476 * SOC + -12.540226111759424) * SOC + 1.1550813551840307)
        + (SOC >= 0.12637688442211056)
        * (SOC < 0.14643718592964824)
        * ((22.28677763548575 * SOC + -7.235996641201524) * SOC + 0.8199153578095064)
        + (SOC >= 0.14643718592964824)
        * (SOC < 0.1614824120603015)
        * ((5.02482586462844 * SOC + -2.1804133592462023) * SOC + 0.44975266328825025)
        + (SOC >= 0.1614824120603015)
        * (SOC < 0.19157286432160803)
        * ((3.107303716296144 * SOC + -1.561121155862704) * SOC + 0.3997502639019974)
        + (SOC >= 0.19157286432160803)
        * (SOC < 0.2517537688442211)
        * (
            (-0.1348854947984961 * SOC + -0.3188902081786793) * SOC
            + 0.28076139350360996
        )
        + (SOC >= 0.2517537688442211)
        * (SOC < 0.28685929648241204)
        * ((-4.393207820206399 * SOC + 1.8252071805711765) * SOC + 0.01086909431019567)
        + (SOC >= 0.28685929648241204)
        * (SOC < 0.30190452261306533)
        * ((-17.74875373087525 * SOC + 9.487532188717267) * SOC + -1.0881354863179844)
        + (SOC >= 0.30190452261306533)
        * (SOC < 0.31694974874371856)
        * ((30.384751611729655 * SOC + -19.575913715587845) * SOC + 3.299057394296952)
        + (SOC >= 0.31694974874371856)
        * (SOC < 0.34704020100502514)
        * ((3.2542005829125884 * SOC + -2.377871051863501) * SOC + 0.5735997437213527)
        + (SOC >= 0.34704020100502514)
        * (SOC < 0.37713065326633166)
        * ((0.8083175790748953 * SOC + -0.6802315932902943) * SOC + 0.27902517425269924)
        + (SOC >= 0.37713065326633166)
        * (SOC < 0.5025075376884423)
        * (
            (0.05667695122594907 * SOC + -0.11329815128590504) * SOC
            + 0.17212118458187764
        )
        + (SOC >= 0.5025075376884423)
        * (SOC < 0.5677035175879397)
        * (
            (-0.5279640038688811 * SOC + 0.47427482226713735) * SOC
            + 0.024491260505669743
        )
        + (SOC >= 0.5677035175879397)
        * (SOC < 0.582748743718593)
        * ((-6.403684546701641 * SOC + 7.1456092633268895) * SOC + -1.8691787540919336)
        + (SOC >= 0.582748743718593)
        * (SOC < 0.5927788944723618)
        * ((5.090840704572997 * SOC + -6.251231036317108) * SOC + 2.0343171731161647)
        + (SOC >= 0.5927788944723618)
        * (SOC < 0.5977939698492463)
        * ((-213.7965887884052 * SOC + 253.25246590117195) * SOC + -74.87984011793162)
        + (SOC >= 0.5977939698492463)
        * (SOC < 0.6028090452261307)
        * ((-27.041551689329253 * SOC + 29.970395867572734) * SOC + -8.141502597159956)
        + (SOC >= 0.6028090452261307)
        * (SOC < 0.607824120603015)
        * ((325.22633701847644 * SOC + -394.7301434439819) * SOC + 119.86516070755022)
        + (SOC >= 0.607824120603015)
        * (SOC < 0.6128391959798994)
        * ((-84.21197551394732 * SOC + 103.0028210684236) * SOC + -31.401890017392248)
        + (SOC >= 0.6128391959798994)
        * (SOC < 0.6278844221105527)
        * ((6.337545487311971 * SOC + -7.98177022512953) * SOC + 2.6059638298573695)
        + (SOC >= 0.6278844221105527)
        * (SOC < 0.7532613065326633)
        * (
            (0.055219990764311166 * SOC + -0.09262159730911579) * SOC
            + 0.12922706629572556
        )
        + (SOC >= 0.7532613065326633)
        * (SOC < 0.8786381909547738)
        * (
            (-0.011749832709947228 * SOC + 0.008269956147848312) * SOC
            + 0.09122821460817487
        )
        + (SOC >= 0.8786381909547738)
        * (SOC < 0.938819095477387)
        * (
            (-0.08775512587896728 * SOC + 0.14183226273387106) * SOC
            + 0.03255174288893059
        )
        + (SOC >= 0.938819095477387)
        * (SOC < 0.9538643216080401)
        * ((-0.583437644148546 * SOC + 1.072544689625488) * SOC + -0.40433355649304303)
        + (SOC >= 0.9538643216080401)
        * (SOC < 0.9689095477386934)
        * ((-0.7849041067989617 * SOC + 1.4568880310711734) * SOC + -0.5876392568193012)
        + (SOC >= 0.9689095477386934)
        * (SOC < 0.9789396984924623)
        * ((-8.958760838734406 * SOC + 17.296343689911737) * SOC + -8.26113916623649)
        + (SOC >= 0.9789396984924623)
        * (SOC < 0.9839547738693467)
        * ((-686.2640629111021 * SOC + 1343.378440086051) * SOC + -657.3383429773813)
        + (SOC >= 0.9839547738693467)
        * (SOC < 0.9939849246231156)
        * ((-622.0560205052128 * SOC + 1217.0228203938912) * SOC + -595.1742353767207)
        + (SOC >= 0.9939849246231156)
        * ((-5411.214994336782 * SOC + 10737.726463618066) * SOC + -5326.892181961326)
    )


def derivative__18650_LG_3500_MJ1_Anode_GITT_dch_ohne_EIS_2320__extraction(SOC):
    return (
        (SOC < 0.006015075376884422) * (10017.914991317906 * SOC + -81.88347557587394)
        + (SOC >= 0.006015075376884422)
        * (SOC < 0.011030150753768845)
        * (2035.1247284474957 * SOC + -33.86639042684935)
        + (SOC >= 0.011030150753768845)
        * (SOC < 0.02106030150753769)
        * (468.52508055751605 * SOC + -16.58656013982172)
        + (SOC >= 0.02106030150753769)
        * (SOC < 0.03610552763819096)
        * (163.41839649780673 * SOC + -10.160921381559184)
        + (SOC >= 0.03610552763819096)
        * (SOC < 0.06619597989949749)
        * (41.32893047526068 * SOC + -5.752816791750165)
        + (SOC >= 0.06619597989949749)
        * (SOC < 0.09628643216080401)
        * (3.2917947947107677 * SOC + -3.23491132280601)
        + (SOC >= 0.09628643216080401)
        * (SOC < 0.11133165829145729)
        * (0.8598325516666137 * SOC + -3.0007463552735203)
        + (SOC >= 0.11133165829145729)
        * (SOC < 0.12637688442211056)
        * (86.54507161917695 * SOC + -12.540226111759424)
        + (SOC >= 0.12637688442211056)
        * (SOC < 0.14643718592964824)
        * (44.5735552709715 * SOC + -7.235996641201524)
        + (SOC >= 0.14643718592964824)
        * (SOC < 0.1614824120603015)
        * (10.04965172925688 * SOC + -2.1804133592462023)
        + (SOC >= 0.1614824120603015)
        * (SOC < 0.19157286432160803)
        * (6.214607432592288 * SOC + -1.561121155862704)
        + (SOC >= 0.19157286432160803)
        * (SOC < 0.2517537688442211)
        * (-0.2697709895969922 * SOC + -0.3188902081786793)
        + (SOC >= 0.2517537688442211)
        * (SOC < 0.28685929648241204)
        * (-8.786415640412798 * SOC + 1.8252071805711765)
        + (SOC >= 0.28685929648241204)
        * (SOC < 0.30190452261306533)
        * (-35.4975074617505 * SOC + 9.487532188717267)
        + (SOC >= 0.30190452261306533)
        * (SOC < 0.31694974874371856)
        * (60.76950322345931 * SOC + -19.575913715587845)
        + (SOC >= 0.31694974874371856)
        * (SOC < 0.34704020100502514)
        * (6.508401165825177 * SOC + -2.377871051863501)
        + (SOC >= 0.34704020100502514)
        * (SOC < 0.37713065326633166)
        * (1.6166351581497906 * SOC + -0.6802315932902943)
        + (SOC >= 0.37713065326633166)
        * (SOC < 0.5025075376884423)
        * (0.11335390245189814 * SOC + -0.11329815128590504)
        + (SOC >= 0.5025075376884423)
        * (SOC < 0.5677035175879397)
        * (-1.0559280077377622 * SOC + 0.47427482226713735)
        + (SOC >= 0.5677035175879397)
        * (SOC < 0.582748743718593)
        * (-12.807369093403281 * SOC + 7.1456092633268895)
        + (SOC >= 0.582748743718593)
        * (SOC < 0.5927788944723618)
        * (10.181681409145995 * SOC + -6.251231036317108)
        + (SOC >= 0.5927788944723618)
        * (SOC < 0.5977939698492463)
        * (-427.5931775768104 * SOC + 253.25246590117195)
        + (SOC >= 0.5977939698492463)
        * (SOC < 0.6028090452261307)
        * (-54.08310337865851 * SOC + 29.970395867572734)
        + (SOC >= 0.6028090452261307)
        * (SOC < 0.607824120603015)
        * (650.4526740369529 * SOC + -394.7301434439819)
        + (SOC >= 0.607824120603015)
        * (SOC < 0.6128391959798994)
        * (-168.42395102789465 * SOC + 103.0028210684236)
        + (SOC >= 0.6128391959798994)
        * (SOC < 0.6278844221105527)
        * (12.675090974623942 * SOC + -7.98177022512953)
        + (SOC >= 0.6278844221105527)
        * (SOC < 0.7532613065326633)
        * (0.11043998152862233 * SOC + -0.09262159730911579)
        + (SOC >= 0.7532613065326633)
        * (SOC < 0.8786381909547738)
        * (-0.023499665419894455 * SOC + 0.008269956147848312)
        + (SOC >= 0.8786381909547738)
        * (SOC < 0.938819095477387)
        * (-0.17551025175793455 * SOC + 0.14183226273387106)
        + (SOC >= 0.938819095477387)
        * (SOC < 0.9538643216080401)
        * (-1.166875288297092 * SOC + 1.072544689625488)
        + (SOC >= 0.9538643216080401)
        * (SOC < 0.9689095477386934)
        * (-1.5698082135979234 * SOC + 1.4568880310711734)
        + (SOC >= 0.9689095477386934)
        * (SOC < 0.9789396984924623)
        * (-17.917521677468812 * SOC + 17.296343689911737)
        + (SOC >= 0.9789396984924623)
        * (SOC < 0.9839547738693467)
        * (-1372.5281258222042 * SOC + 1343.378440086051)
        + (SOC >= 0.9839547738693467)
        * (SOC < 0.9939849246231156)
        * (-1244.1120410104256 * SOC + 1217.0228203938912)
        + (SOC >= 0.9939849246231156) * (-10822.429988673564 * SOC + 10737.726463618066)
    )


# Discharge profile - lithiation direction of cathode
def _18650_LG_3500_MJ1_Cathode_GITT_ch_ohne_EIS_2327__extraction(SOC):
    return (
        (SOC < 0.006015075376884422)
        * ((2943.810072716413 * SOC + -45.47969560495423) * SOC + 4.446944580747672)
        + (SOC >= 0.006015075376884422)
        * (SOC < 0.011030150753768845)
        * ((634.1988911293374 * SOC + -17.694724907871773) * SOC + 4.363380234203933)
        + (SOC >= 0.011030150753768845)
        * (SOC < 0.02106030150753769)
        * ((113.15861792600845 * SOC + -6.200419383436554) * SOC + 4.299988272831737)
        + (SOC >= 0.02106030150753769)
        * (SOC < 0.03610552763819096)
        * ((23.223632167815595 * SOC + -2.4123035511492503) * SOC + 4.26009884204501)
        + (SOC >= 0.03610552763819096)
        * (SOC < 0.06619597989949749)
        * ((4.859053133897305 * SOC + -1.0861779194034114) * SOC + 4.236158609220656)
        + (SOC >= 0.06619597989949749)
        * (SOC < 0.09628643216080401)
        * ((0.4366753467279523 * SOC + -0.500690657188386) * SOC + 4.216780157700159)
        + (SOC >= 0.09628643216080401)
        * (SOC < 0.12637688442211056)
        * ((-0.6822066464878844 * SOC + -0.2852243469172322) * SOC + 4.206406916566717)
        + (SOC >= 0.12637688442211056)
        * (SOC < 0.1614824120603015)
        * ((-4.887988966797366 * SOC + 0.777802985479525) * SOC + 4.139235875404793)
        + (SOC >= 0.1614824120603015)
        * (SOC < 0.17652763819095477)
        * ((-11.823704457352505 * SOC + 3.017795119036691) * SOC + 3.9583762090433083)
        + (SOC >= 0.17652763819095477)
        * (SOC < 0.19157286432160803)
        * ((-3.138277623014801 * SOC + -0.04864065245465099) * SOC + 4.229031541246172)
        + (SOC >= 0.19157286432160803)
        * (SOC < 0.2517537688442211)
        * ((3.1305873867419223 * SOC + -2.4505295043838373) * SOC + 4.4590999048192685)
        + (SOC >= 0.2517537688442211)
        * (SOC < 0.31694974874371856)
        * ((0.7365036271785357 * SOC + -1.2450902855862012) * SOC + 4.307362971596806)
        + (SOC >= 0.31694974874371856)
        * (SOC < 0.37713065326633166)
        * ((-0.6342814441555902 * SOC + -0.3761503177043437) * SOC + 4.1696578193500216)
        + (SOC >= 0.37713065326633166)
        * (SOC < 0.41223618090452263)
        * ((-1.2465376975685558 * SOC + 0.08565088392765574) * SOC + 4.082578124924652)
        + (SOC >= 0.41223618090452263)
        * (SOC < 0.44232663316582915)
        * ((-0.5336389055478321 * SOC + -0.5021144668608031) * SOC + 4.203727196663067)
        + (SOC >= 0.44232663316582915)
        * (SOC < 0.4724170854271357)
        * ((0.8427801315624492 * SOC + -1.7197680638812471) * SOC + 4.473027504629329)
        + (SOC >= 0.4724170854271357)
        * (SOC < 0.5025075376884423)
        * ((2.2869769138767424 * SOC + -3.084294533249931) * SOC + 4.7953403134528685)
        + (SOC >= 0.5025075376884423)
        * (SOC < 0.5677035175879397)
        * ((1.624528113077531 * SOC + -2.4185235017808964) * SOC + 4.628062832609103)
        + (SOC >= 0.5677035175879397)
        * (SOC < 0.6278844221105527)
        * ((0.6844382533436715 * SOC + -1.3511388613416102) * SOC + 4.325083825110767)
        + (SOC >= 0.6278844221105527)
        * (SOC < 0.6930804020100503)
        * ((0.12517928333738837 * SOC + -0.6488388709564106) * SOC + 4.1046022133051565)
        + (SOC >= 0.6930804020100503)
        * (SOC < 0.7532613065326633)
        * ((-0.42125376061284214 * SOC + 0.1086051965887691) * SOC + 3.842117393888003)
        + (SOC >= 0.7532613065326633)
        * (SOC < 0.8184572864321608)
        * ((-1.0456222985791328 * SOC + 1.049230517921501) * SOC + 3.487849064635668)
        + (SOC >= 0.8184572864321608)
        * (SOC < 0.8485477386934673)
        * ((-0.5071542408868481 * SOC + 0.16780430726248596) * SOC + 3.8485539169184904)
        + (SOC >= 0.8485477386934673)
        * (SOC < 0.8786381909547738)
        * ((1.1369428932853225 * SOC + -2.622385503525493) * SOC + 5.032358544153567)
        + (SOC >= 0.8786381909547738)
        * (SOC < 0.9087286432160804)
        * ((0.6050016717372273 * SOC + -1.687617758334909) * SOC + 4.621697223854881)
        + (SOC >= 0.9087286432160804)
        * (SOC < 0.938819095477387)
        * ((-0.904926011592579 * SOC + 1.0566113117188252) * SOC + 3.3748174441032006)
        + (SOC >= 0.938819095477387)
        * (SOC < 0.9689095477386934)
        * ((-6.697727169005248 * SOC + 11.933395997483785) * SOC + -1.730849136093184)
        + (SOC >= 0.9689095477386934)
        * (SOC < 0.9839547738693467)
        * ((-37.178817824355065 * SOC + 71.00023552039784) * SOC + -30.3460615203403)
        + (SOC >= 0.9839547738693467)
        * (SOC < 0.9889698492462311)
        * ((-142.86486270722526 * SOC + 278.9808123081457) * SOC + -132.66780222153466)
        + (SOC >= 0.9889698492462311)
        * (SOC < 0.9939849246231156)
        * ((-315.0640613306459 * SOC + 619.5804433139565) * SOC + -301.08918508613715)
        + (SOC >= 0.9939849246231156)
        * ((-2264.12836692133 * SOC + 4494.261517070292) * SOC + -2226.7764726042806)
    )


def derivative__18650_LG_3500_MJ1_Cathode_GITT_ch_ohne_EIS_2327__extraction(SOC):
    return (
        (SOC < 0.006015075376884422) * (5887.620145432826 * SOC + -45.47969560495423)
        + (SOC >= 0.006015075376884422)
        * (SOC < 0.011030150753768845)
        * (1268.3977822586749 * SOC + -17.694724907871773)
        + (SOC >= 0.011030150753768845)
        * (SOC < 0.02106030150753769)
        * (226.3172358520169 * SOC + -6.200419383436554)
        + (SOC >= 0.02106030150753769)
        * (SOC < 0.03610552763819096)
        * (46.44726433563119 * SOC + -2.4123035511492503)
        + (SOC >= 0.03610552763819096)
        * (SOC < 0.06619597989949749)
        * (9.71810626779461 * SOC + -1.0861779194034114)
        + (SOC >= 0.06619597989949749)
        * (SOC < 0.09628643216080401)
        * (0.8733506934559045 * SOC + -0.500690657188386)
        + (SOC >= 0.09628643216080401)
        * (SOC < 0.12637688442211056)
        * (-1.3644132929757689 * SOC + -0.2852243469172322)
        + (SOC >= 0.12637688442211056)
        * (SOC < 0.1614824120603015)
        * (-9.775977933594731 * SOC + 0.777802985479525)
        + (SOC >= 0.1614824120603015)
        * (SOC < 0.17652763819095477)
        * (-23.64740891470501 * SOC + 3.017795119036691)
        + (SOC >= 0.17652763819095477)
        * (SOC < 0.19157286432160803)
        * (-6.276555246029602 * SOC + -0.04864065245465099)
        + (SOC >= 0.19157286432160803)
        * (SOC < 0.2517537688442211)
        * (6.2611747734838445 * SOC + -2.4505295043838373)
        + (SOC >= 0.2517537688442211)
        * (SOC < 0.31694974874371856)
        * (1.4730072543570714 * SOC + -1.2450902855862012)
        + (SOC >= 0.31694974874371856)
        * (SOC < 0.37713065326633166)
        * (-1.2685628883111804 * SOC + -0.3761503177043437)
        + (SOC >= 0.37713065326633166)
        * (SOC < 0.41223618090452263)
        * (-2.4930753951371116 * SOC + 0.08565088392765574)
        + (SOC >= 0.41223618090452263)
        * (SOC < 0.44232663316582915)
        * (-1.0672778110956642 * SOC + -0.5021144668608031)
        + (SOC >= 0.44232663316582915)
        * (SOC < 0.4724170854271357)
        * (1.6855602631248985 * SOC + -1.7197680638812471)
        + (SOC >= 0.4724170854271357)
        * (SOC < 0.5025075376884423)
        * (4.573953827753485 * SOC + -3.084294533249931)
        + (SOC >= 0.5025075376884423)
        * (SOC < 0.5677035175879397)
        * (3.249056226155062 * SOC + -2.4185235017808964)
        + (SOC >= 0.5677035175879397)
        * (SOC < 0.6278844221105527)
        * (1.368876506687343 * SOC + -1.3511388613416102)
        + (SOC >= 0.6278844221105527)
        * (SOC < 0.6930804020100503)
        * (0.25035856667477674 * SOC + -0.6488388709564106)
        + (SOC >= 0.6930804020100503)
        * (SOC < 0.7532613065326633)
        * (-0.8425075212256843 * SOC + 0.1086051965887691)
        + (SOC >= 0.7532613065326633)
        * (SOC < 0.8184572864321608)
        * (-2.0912445971582656 * SOC + 1.049230517921501)
        + (SOC >= 0.8184572864321608)
        * (SOC < 0.8485477386934673)
        * (-1.0143084817736963 * SOC + 0.16780430726248596)
        + (SOC >= 0.8485477386934673)
        * (SOC < 0.8786381909547738)
        * (2.273885786570645 * SOC + -2.622385503525493)
        + (SOC >= 0.8786381909547738)
        * (SOC < 0.9087286432160804)
        * (1.2100033434744546 * SOC + -1.687617758334909)
        + (SOC >= 0.9087286432160804)
        * (SOC < 0.938819095477387)
        * (-1.809852023185158 * SOC + 1.0566113117188252)
        + (SOC >= 0.938819095477387)
        * (SOC < 0.9689095477386934)
        * (-13.395454338010495 * SOC + 11.933395997483785)
        + (SOC >= 0.9689095477386934)
        * (SOC < 0.9839547738693467)
        * (-74.35763564871013 * SOC + 71.00023552039784)
        + (SOC >= 0.9839547738693467)
        * (SOC < 0.9889698492462311)
        * (-285.7297254144505 * SOC + 278.9808123081457)
        + (SOC >= 0.9889698492462311)
        * (SOC < 0.9939849246231156)
        * (-630.1281226612919 * SOC + 619.5804433139565)
        + (SOC >= 0.9939849246231156) * (-4528.25673384266 * SOC + 4494.261517070292)
    )


#####################################################################
# Exchange-current densities (mean of lithiation and delithiation). #
#####################################################################

# In order to be pickleable and therefore parellizable, the returned functions
# have to get the parameters via their names rather than directly as numbers.


def graphite_exchange_prefactor(cₑ, cₙ, cₙ_max, T):
    αₙₙ = Parameter("Anodic symmetry factor at Graphite-SiOx")
    αₚₙ = Parameter("Cathodic symmetry factor at Graphite-SiOx")
    return Negative_electrode_exchange_current_density_A_per_m2(cₙ / cₙ_max)


def graphite_exchange_prefactor_derivative(cₑ, cₙ, cₙ_max, T):
    αₙₙ = Parameter("Anodic symmetry factor at Graphite-SiOx")
    αₚₙ = Parameter("Cathodic symmetry factor at Graphite-SiOx")
    return Negative_electrode_exchange_current_density_A_per_m2(cₙ / cₙ_max) * αₚₙ / cₑ


def nmc_exchange_prefactor(cₑ, cₚ, cₚ_max, T):
    αₙₚ = Parameter("Anodic symmetry factor at NMC")
    αₚₚ = Parameter("Cathodic symmetry factor at NMC")
    return Positive_electrode_exchange_current_density_A_per_m2(cₚ / cₚ_max)


def nmc_exchange_prefactor_derivative(cₑ, cₚ, cₚ_max, T):
    αₙₚ = Parameter("Anodic symmetry factor at NMC")
    αₚₚ = Parameter("Cathodic symmetry factor at NMC")
    return Positive_electrode_exchange_current_density_A_per_m2(cₚ / cₚ_max) * αₚₚ / cₑ


def Negative_electrode_exchange_current_density_A_per_m2(SOC):
    return 10 * exp(
        (SOC < 0.025)
        * ((27.834463836969007 * SOC + 15.96473196936472) * SOC + -2.37212952830029)
        + (SOC >= 0.025)
        * (SOC < 0.035)
        * ((-421.1589223786759 * SOC + 38.41440128014693) * SOC + -2.6527503946850706)
        + (SOC >= 0.035)
        * (SOC < 0.045)
        * ((217.6317365328614 * SOC + -6.300944843660545) * SOC + -1.8702318375184337)
        + (SOC >= 0.045)
        * (SOC < 0.055)
        * ((-164.31938405500932 * SOC + 28.074656009247747) * SOC + -2.6436828567088675)
        + (SOC >= 0.055)
        * (SOC < 0.065)
        * ((12.249126997133317 * SOC + 8.652119793512156) * SOC + -2.1095631107761363)
        + (SOC >= 0.065)
        * (SOC < 0.07500000000000001)
        * ((-265.95640077690587 * SOC + 44.81883840413718) * SOC + -3.2849814656214527)
        + (SOC >= 0.07500000000000001)
        * (SOC < 0.08499999999999999)
        * ((-68.90850892584058 * SOC + 15.261654626477366) * SOC + -2.1765870739592046)
        + (SOC >= 0.08499999999999999)
        * (SOC < 0.095)
        * ((62.94976632331509 * SOC + -7.154252165879257) * SOC + -1.2239110352840648)
        + (SOC >= 0.095)
        * (SOC < 0.125)
        * ((-55.70510160059371 * SOC + 15.39017273966347) * SOC + -2.294771218297342)
        + (SOC >= 0.125)
        * (SOC < 0.175)
        * ((-8.718685210812424 * SOC + 3.6435686422181988) * SOC + -1.5606084622070107)
        + (SOC >= 0.175)
        * (SOC < 0.225)
        * ((-1.3638025119056465 * SOC + 1.0693596976008024) * SOC + -1.3353651795529888)
        + (SOC >= 0.225)
        * (SOC < 0.275)
        * ((-1.664089416211823 * SOC + 1.2044888045385846) * SOC + -1.3505672040834895)
        + (SOC >= 0.275)
        * (SOC < 0.325)
        * ((-5.8675333935170215 * SOC + 3.5163829920564496) * SOC + -1.6684526548671954)
        + (SOC >= 0.325)
        * (SOC < 0.375)
        * ((8.136678418185596 * SOC + -5.586354685550219) * SOC + -0.18925778225610657)
        + (SOC >= 0.375)
        * (SOC < 0.42500000000000004)
        * ((-12.650013231256338 * SOC + 10.003664051531217) * SOC + -3.112386295458876)
        + (SOC >= 0.42500000000000004)
        * (SOC < 0.475)
        * ((7.051634371483175 * SOC + -6.742736410797363) * SOC + 0.4462238027859371)
        + (SOC >= 0.475)
        * (SOC < 0.525)
        * ((13.008911741853609 * SOC + -12.402149912649264) * SOC + 1.7903345094757839)
        + (SOC >= 0.525)
        * (SOC < 0.575)
        * ((-5.123050444802772 * SOC + 6.636410383339978) * SOC + -3.2072875682214033)
        + (SOC >= 0.575)
        * (SOC < 0.625)
        * ((-11.687431501401761 * SOC + 14.185448598428735) * SOC + -5.377636055059426)
        + (SOC >= 0.625)
        * (SOC < 0.675)
        * ((27.71556168605477 * SOC + -35.06829288589191) * SOC + 10.014158158790764)
        + (SOC >= 0.675)
        * (SOC < 0.7250000000000001)
        * ((-26.145992534672075 * SOC + 37.64480531208926) * SOC + -14.526512483027872)
        + (SOC >= 0.7250000000000001)
        * (SOC < 0.775)
        * ((4.67282667236347 * SOC + -7.042482538112154) * SOC + 1.6726293626701505)
        + (SOC >= 0.775)
        * (SOC < 0.825)
        * ((4.586035801125973 * SOC + -6.907956687694082) * SOC + 1.6205005956331178)
        + (SOC >= 0.825)
        * (SOC < 0.875)
        * ((-7.501318516918673 * SOC + 13.036177937079515) * SOC + -6.606454937085999)
        + (SOC >= 0.875)
        * (SOC < 0.905)
        * ((34.06912325716132 * SOC + -59.71209516756062) * SOC + 25.220914546193967)
        + (SOC >= 0.905)
        * (SOC < 0.915)
        * ((-198.116031360747 * SOC + 360.54303469085517) * SOC + -164.9445317147397)
        + (SOC >= 0.915)
        * (SOC < 0.925)
        * ((155.68989428587975 * SOC + -286.92180924247623) * SOC + 131.2706343847599)
        + (SOC >= 0.925)
        * (SOC < 0.935)
        * ((-44.90589213903786 * SOC + 84.18039564362516) * SOC + -40.36413537506178)
        + (SOC >= 0.935)
        * (SOC < 0.9450000000000001)
        * ((-17.448644009964482 * SOC + 32.835341642256026) * SOC + -16.360322629421717)
        + (SOC >= 0.9450000000000001)
        * (SOC < 0.9550000000000001)
        * ((75.85275901431578 * SOC + -143.50431007363295) * SOC + 66.96016280633694)
        + (SOC >= 0.9550000000000001)
        * (SOC < 0.965)
        * ((-214.9570579656629 * SOC + 411.94244035812335) * SOC + -198.2656605248285)
        + (SOC >= 0.965)
        * (SOC < 0.975)
        * ((136.24296138879663 * SOC + -265.87359699598073) * SOC + 128.7805774985277)
        + (SOC >= 0.975)
        * ((-92.57872949167268 * SOC + 180.32870022093448) * SOC + -88.74304239471894)
    )


def derivative_Negative_electrode_exchange_current_density_A_per_m2(SOC):
    return (
        10
        * Negative_electrode_exchange_current_density_A_per_m2(SOC)
        * (
            (SOC < 0.025) * (55.668927673938015 * SOC + 15.96473196936472)
            + (SOC >= 0.025)
            * (SOC < 0.035)
            * (-842.3178447573518 * SOC + 38.41440128014693)
            + (SOC >= 0.035)
            * (SOC < 0.045)
            * (435.2634730657228 * SOC + -6.300944843660545)
            + (SOC >= 0.045)
            * (SOC < 0.055)
            * (-328.63876811001865 * SOC + 28.074656009247747)
            + (SOC >= 0.055)
            * (SOC < 0.065)
            * (24.498253994266634 * SOC + 8.652119793512156)
            + (SOC >= 0.065)
            * (SOC < 0.07500000000000001)
            * (-531.9128015538117 * SOC + 44.81883840413718)
            + (SOC >= 0.07500000000000001)
            * (SOC < 0.08499999999999999)
            * (-137.81701785168116 * SOC + 15.261654626477366)
            + (SOC >= 0.08499999999999999)
            * (SOC < 0.095)
            * (125.89953264663018 * SOC + -7.154252165879257)
            + (SOC >= 0.095)
            * (SOC < 0.125)
            * (-111.41020320118741 * SOC + 15.39017273966347)
            + (SOC >= 0.125)
            * (SOC < 0.175)
            * (-17.43737042162485 * SOC + 3.6435686422181988)
            + (SOC >= 0.175)
            * (SOC < 0.225)
            * (-2.727605023811293 * SOC + 1.0693596976008024)
            + (SOC >= 0.225)
            * (SOC < 0.275)
            * (-3.328178832423646 * SOC + 1.2044888045385846)
            + (SOC >= 0.275)
            * (SOC < 0.325)
            * (-11.735066787034043 * SOC + 3.5163829920564496)
            + (SOC >= 0.325)
            * (SOC < 0.375)
            * (16.273356836371192 * SOC + -5.586354685550219)
            + (SOC >= 0.375)
            * (SOC < 0.42500000000000004)
            * (-25.300026462512676 * SOC + 10.003664051531217)
            + (SOC >= 0.42500000000000004)
            * (SOC < 0.475)
            * (14.10326874296635 * SOC + -6.742736410797363)
            + (SOC >= 0.475)
            * (SOC < 0.525)
            * (26.017823483707218 * SOC + -12.402149912649264)
            + (SOC >= 0.525)
            * (SOC < 0.575)
            * (-10.246100889605543 * SOC + 6.636410383339978)
            + (SOC >= 0.575)
            * (SOC < 0.625)
            * (-23.374863002803522 * SOC + 14.185448598428735)
            + (SOC >= 0.625)
            * (SOC < 0.675)
            * (55.43112337210954 * SOC + -35.06829288589191)
            + (SOC >= 0.675)
            * (SOC < 0.7250000000000001)
            * (-52.29198506934415 * SOC + 37.64480531208926)
            + (SOC >= 0.7250000000000001)
            * (SOC < 0.775)
            * (9.34565334472694 * SOC + -7.042482538112154)
            + (SOC >= 0.775)
            * (SOC < 0.825)
            * (9.172071602251947 * SOC + -6.907956687694082)
            + (SOC >= 0.825)
            * (SOC < 0.875)
            * (-15.002637033837345 * SOC + 13.036177937079515)
            + (SOC >= 0.875)
            * (SOC < 0.905)
            * (68.13824651432265 * SOC + -59.71209516756062)
            + (SOC >= 0.905)
            * (SOC < 0.915)
            * (-396.232062721494 * SOC + 360.54303469085517)
            + (SOC >= 0.915)
            * (SOC < 0.925)
            * (311.3797885717595 * SOC + -286.92180924247623)
            + (SOC >= 0.925)
            * (SOC < 0.935)
            * (-89.81178427807572 * SOC + 84.18039564362516)
            + (SOC >= 0.935)
            * (SOC < 0.9450000000000001)
            * (-34.897288019928965 * SOC + 32.835341642256026)
            + (SOC >= 0.9450000000000001)
            * (SOC < 0.9550000000000001)
            * (151.70551802863156 * SOC + -143.50431007363295)
            + (SOC >= 0.9550000000000001)
            * (SOC < 0.965)
            * (-429.9141159313258 * SOC + 411.94244035812335)
            + (SOC >= 0.965)
            * (SOC < 0.975)
            * (272.48592277759326 * SOC + -265.87359699598073)
            + (SOC >= 0.975) * (-185.15745898334535 * SOC + 180.32870022093448)
        )
    )


def Positive_electrode_exchange_current_density_A_per_m2(SOC):
    return 10 * exp(
        (SOC < 0.025)
        * ((54.0509009047164 * SOC + 3.998665364455661) * SOC + -3.691443849291202)
        + (SOC >= 0.025)
        * (SOC < 0.035)
        * ((273.8859954657528 * SOC + -6.993089363596141) * SOC + -3.554046915190554)
        + (SOC >= 0.035)
        * (SOC < 0.045)
        * ((-143.05889379391738 * SOC + 22.19305288458122) * SOC + -4.06480440453365)
        + (SOC >= 0.045)
        * (SOC < 0.055)
        * ((130.55575990440957 * SOC + -2.432265948268423) * SOC + -3.5107347307945282)
        + (SOC >= 0.055)
        * (SOC < 0.065)
        * ((-754.7160368399291 * SOC + 94.94763169360886) * SOC + -6.1886819159461695)
        + (SOC >= 0.065)
        * (SOC < 0.07500000000000001)
        * ((334.39532447137026 * SOC + -46.63684527685973) * SOC + -1.5871864144059202)
        + (SOC >= 0.07500000000000001)
        * (SOC < 0.08499999999999999)
        * ((-229.28479085109575 * SOC + 37.91517202150908) * SOC + -4.757887063094785)
        + (SOC >= 0.08499999999999999)
        * (SOC < 0.095)
        * ((874.1806496138752 * SOC + -149.67395285753605) * SOC + 3.214650744264631)
        + (SOC >= 0.095)
        * (SOC < 0.125)
        * ((-353.73204821775016 * SOC + 83.62945973047312) * SOC + -7.867261353665796)
        + (SOC >= 0.125)
        * (SOC < 0.175)
        * ((84.72715236061845 * SOC + -25.985340414118866) * SOC + -1.0163363446287885)
        + (SOC >= 0.175)
        * (SOC < 0.225)
        * ((-37.203377576212915 * SOC + 16.690345063772128) * SOC + -4.750458823944243)
        + (SOC >= 0.225)
        * (SOC < 0.275)
        * ((17.518468468908395 * SOC + -7.93448565653253) * SOC + -1.9801653679099687)
        + (SOC >= 0.275)
        * (SOC < 0.325)
        * ((-17.48343037918687 * SOC + 11.316558709919832) * SOC + -4.627183968297189)
        + (SOC >= 0.325)
        * (SOC < 0.375)
        * ((36.811763420237526 * SOC + -23.975317259706003) * SOC + 1.1077458767670336)
        + (SOC >= 0.375)
        * (SOC < 0.42500000000000004)
        * ((-28.853775299433096 * SOC + 25.273836780046963) * SOC + -8.126470505686669)
        + (SOC >= 0.42500000000000004)
        * (SOC < 0.475)
        * ((-15.027367958237164 * SOC + 13.521390540030438) * SOC + -5.629075679683169)
        + (SOC >= 0.475)
        * (SOC < 0.525)
        * ((14.027957971693013 * SOC + -14.081169093403162) * SOC + 0.9265322332573334)
        + (SOC >= 0.525)
        * (SOC < 0.575)
        * ((3.033601250402455 * SOC + -2.53709453604813) * SOC + -2.1037873380483063)
        + (SOC >= 0.575)
        * (SOC < 0.625)
        * ((-5.979243172813028 * SOC + 7.827676550649585) * SOC + -5.083659025473992)
        + (SOC >= 0.625)
        * (SOC < 0.675)
        * ((-0.8724007621615328 * SOC + 1.4441235373352583) * SOC + -3.088798708813215)
        + (SOC >= 0.675)
        * (SOC < 0.7250000000000001)
        * ((-17.167772160183915 * SOC + 23.44287492466549) * SOC + -10.513377302037185)
        + (SOC >= 0.7250000000000001)
        * (SOC < 0.775)
        * ((-17.31420489184609 * SOC + 23.655202385575876) * SOC + -10.590346006617153)
        + (SOC >= 0.775)
        * (SOC < 0.825)
        * ((-3.67823352233529 * SOC + 2.5194467628340362) * SOC + -2.4002407028046946)
        + (SOC >= 0.825)
        * (SOC < 0.875)
        * ((13.257260038885875 * SOC + -25.424117613180897) * SOC + 9.126479602301288)
        + (SOC >= 0.875)
        * (SOC < 0.905)
        * ((-290.7726722841667 * SOC + 506.6282639521596) * SOC + -223.6464373325357)
        + (SOC >= 0.905)
        * (SOC < 0.915)
        * ((1179.0782200890171 * SOC + -2153.8018512433046) * SOC + 980.1981897934111)
        + (SOC >= 0.915)
        * (SOC < 0.925)
        * ((-917.3897065212404 * SOC + 1682.7344544534644) * SOC + -775.0171700628598)
        + (SOC >= 0.925)
        * (SOC < 0.935)
        * ((867.0386453967003 * SOC + -1618.4579965947196) * SOC + 751.7843385469278)
        + (SOC >= 0.935)
        * (SOC < 0.9450000000000001)
        * ((-479.85724574424603 * SOC + 900.237319838845) * SOC + -425.70572188576443)
        + (SOC >= 0.9450000000000001)
        * (SOC < 0.9550000000000001)
        * ((-62.156860698272794 * SOC + 110.78359210195049) * SOC + -52.68883553008527)
        + (SOC >= 0.9550000000000001)
        * (SOC < 0.965)
        * ((-1437.1297827765193 * SOC + 2736.981873271412) * SOC + -1306.6985147884952)
        + (SOC >= 0.965)
        * (SOC < 0.975)
        * ((2251.176102712596 * SOC + -4381.448485722583) * SOC + 2127.944133426101)
        + (SOC >= 0.975)
        * ((-1191.2980844287886 * SOC + 2331.376179203122) * SOC + -1144.5578907251765)
    )


def derivative_Positive_electrode_exchange_current_density_A_per_m2(SOC):
    return (
        10
        * Positive_electrode_exchange_current_density_A_per_m2(SOC)
        * (
            (SOC < 0.025) * (108.1018018094328 * SOC + 3.998665364455661)
            + (SOC >= 0.025)
            * (SOC < 0.035)
            * (547.7719909315056 * SOC + -6.993089363596141)
            + (SOC >= 0.035)
            * (SOC < 0.045)
            * (-286.11778758783475 * SOC + 22.19305288458122)
            + (SOC >= 0.045)
            * (SOC < 0.055)
            * (261.11151980881914 * SOC + -2.432265948268423)
            + (SOC >= 0.055)
            * (SOC < 0.065)
            * (-1509.4320736798581 * SOC + 94.94763169360886)
            + (SOC >= 0.065)
            * (SOC < 0.07500000000000001)
            * (668.7906489427405 * SOC + -46.63684527685973)
            + (SOC >= 0.07500000000000001)
            * (SOC < 0.08499999999999999)
            * (-458.5695817021915 * SOC + 37.91517202150908)
            + (SOC >= 0.08499999999999999)
            * (SOC < 0.095)
            * (1748.3612992277504 * SOC + -149.67395285753605)
            + (SOC >= 0.095)
            * (SOC < 0.125)
            * (-707.4640964355003 * SOC + 83.62945973047312)
            + (SOC >= 0.125)
            * (SOC < 0.175)
            * (169.4543047212369 * SOC + -25.985340414118866)
            + (SOC >= 0.175)
            * (SOC < 0.225)
            * (-74.40675515242583 * SOC + 16.690345063772128)
            + (SOC >= 0.225)
            * (SOC < 0.275)
            * (35.03693693781679 * SOC + -7.93448565653253)
            + (SOC >= 0.275)
            * (SOC < 0.325)
            * (-34.96686075837374 * SOC + 11.316558709919832)
            + (SOC >= 0.325)
            * (SOC < 0.375)
            * (73.62352684047505 * SOC + -23.975317259706003)
            + (SOC >= 0.375)
            * (SOC < 0.42500000000000004)
            * (-57.70755059886619 * SOC + 25.273836780046963)
            + (SOC >= 0.42500000000000004)
            * (SOC < 0.475)
            * (-30.05473591647433 * SOC + 13.521390540030438)
            + (SOC >= 0.475)
            * (SOC < 0.525)
            * (28.055915943386026 * SOC + -14.081169093403162)
            + (SOC >= 0.525)
            * (SOC < 0.575)
            * (6.06720250080491 * SOC + -2.53709453604813)
            + (SOC >= 0.575)
            * (SOC < 0.625)
            * (-11.958486345626056 * SOC + 7.827676550649585)
            + (SOC >= 0.625)
            * (SOC < 0.675)
            * (-1.7448015243230657 * SOC + 1.4441235373352583)
            + (SOC >= 0.675)
            * (SOC < 0.7250000000000001)
            * (-34.33554432036783 * SOC + 23.44287492466549)
            + (SOC >= 0.7250000000000001)
            * (SOC < 0.775)
            * (-34.62840978369218 * SOC + 23.655202385575876)
            + (SOC >= 0.775)
            * (SOC < 0.825)
            * (-7.35646704467058 * SOC + 2.5194467628340362)
            + (SOC >= 0.825)
            * (SOC < 0.875)
            * (26.51452007777175 * SOC + -25.424117613180897)
            + (SOC >= 0.875)
            * (SOC < 0.905)
            * (-581.5453445683333 * SOC + 506.6282639521596)
            + (SOC >= 0.905)
            * (SOC < 0.915)
            * (2358.1564401780342 * SOC + -2153.8018512433046)
            + (SOC >= 0.915)
            * (SOC < 0.925)
            * (-1834.7794130424809 * SOC + 1682.7344544534644)
            + (SOC >= 0.925)
            * (SOC < 0.935)
            * (1734.0772907934006 * SOC + -1618.4579965947196)
            + (SOC >= 0.935)
            * (SOC < 0.9450000000000001)
            * (-959.7144914884921 * SOC + 900.237319838845)
            + (SOC >= 0.9450000000000001)
            * (SOC < 0.9550000000000001)
            * (-124.31372139654559 * SOC + 110.78359210195049)
            + (SOC >= 0.9550000000000001)
            * (SOC < 0.965)
            * (-2874.2595655530386 * SOC + 2736.981873271412)
            + (SOC >= 0.965)
            * (SOC < 0.975)
            * (4502.352205425192 * SOC + -4381.448485722583)
            + (SOC >= 0.975) * (-2382.596168857577 * SOC + 2331.376179203122)
        )
    )


##################
# Diffusivities. #
##################


# Discharge profile - Delithiation direction of the Anode
def Negative_electrode_diffusivity__m2_s_1_(Negative_electrode_SOC____, T):
    return exp(
        (Negative_electrode_SOC____ < 0.09913139478844102)
        * (
            (28.968262165814508 * Negative_electrode_SOC____ + 5.625713621193107)
            * Negative_electrode_SOC____
            + -33.24419027877485
        )
        + (Negative_electrode_SOC____ >= 0.09913139478844102)
        * (Negative_electrode_SOC____ < 0.4956458667127428)
        * (
            (-24.866807392848557 * Negative_electrode_SOC____ + 16.29920468895898)
            * Negative_electrode_SOC____
            + -33.77322930717966
        )
        + (Negative_electrode_SOC____ >= 0.4956458667127428)
        * (Negative_electrode_SOC____ < 0.6939030739440655)
        * (
            (-41.70002742886413 * Negative_electrode_SOC____ + 32.985836557593416)
            * Negative_electrode_SOC____
            + -37.90855936470258
        )
        + (Negative_electrode_SOC____ >= 0.6939030739440655)
        * (Negative_electrode_SOC____ < 0.8921603579383661)
        * (
            (183.2186924065055 * Negative_electrode_SOC____ + -279.15774560506054)
            * Negative_electrode_SOC____
            + 70.3901362225862
        )
        + (Negative_electrode_SOC____ >= 0.8921603579383661)
        * (
            (-301.42626762424334 * Negative_electrode_SOC____ + 585.6042964230546)
            * Negative_electrode_SOC____
            + -315.36307025107135
        )
    )


def derivative_Negative_electrode_diffusivity__m2_s_1_(Negative_electrode_SOC____, T):
    return Negative_electrode_diffusivity__m2_s_1_(Negative_electrode_SOC____) * (
        (Negative_electrode_SOC____ < 0.09913139478844102)
        * (57.936524331629016 * Negative_electrode_SOC____ + 5.625713621193107)
        + (Negative_electrode_SOC____ >= 0.09913139478844102)
        * (Negative_electrode_SOC____ < 0.4956458667127428)
        * (-49.733614785697114 * Negative_electrode_SOC____ + 16.29920468895898)
        + (Negative_electrode_SOC____ >= 0.4956458667127428)
        * (Negative_electrode_SOC____ < 0.6939030739440655)
        * (-83.40005485772826 * Negative_electrode_SOC____ + 32.985836557593416)
        + (Negative_electrode_SOC____ >= 0.6939030739440655)
        * (Negative_electrode_SOC____ < 0.8921603579383661)
        * (366.437384813011 * Negative_electrode_SOC____ + -279.15774560506054)
        + (Negative_electrode_SOC____ >= 0.8921603579383661)
        * (-602.8525352484867 * Negative_electrode_SOC____ + 585.6042964230546)
    )


# Discharge profile - lithiation direction of cathode


def Positive_electrode_diffusivity__m2_s_1_(Positive_electrode_SOC____, T):
    return exp(
        (Positive_electrode_SOC____ < 0.3382277436623123)
        * (
            (27.982955482386558 * Positive_electrode_SOC____ + -12.143707202132319)
            * Positive_electrode_SOC____
            + -33.0217804711556
        )
        + (Positive_electrode_SOC____ >= 0.3382277436623123)
        * (Positive_electrode_SOC____ < 0.6665106367866339)
        * (
            (-11.319201599513178 * Positive_electrode_SOC____ + 14.44245261961305)
            * Positive_electrode_SOC____
            + -37.51786889573288
        )
        + (Positive_electrode_SOC____ >= 0.6665106367866339)
        * (Positive_electrode_SOC____ < 0.8822401369572627)
        * (
            (-25.591142520785183 * Positive_electrode_SOC____ + 33.4672534828494)
            * Positive_electrode_SOC____
            + -43.85798496478026
        )
        + (Positive_electrode_SOC____ >= 0.8822401369572627)
        * (
            (-190.3629702643384 * Positive_electrode_SOC____ + 324.2038932331925)
            * Positive_electrode_SOC____
            + -172.10775140069836
        )
    )


def derivative_Positive_electrode_diffusivity__m2_s_1_(Positive_electrode_SOC____, T):
    return Positive_electrode_diffusivity__m2_s_1_(Positive_electrode_SOC____) * (
        (Positive_electrode_SOC____ < 0.3382277436623123)
        * (55.965910964773116 * Positive_electrode_SOC____ + -12.143707202132319)
        + (Positive_electrode_SOC____ >= 0.3382277436623123)
        * (Positive_electrode_SOC____ < 0.6665106367866339)
        * (-22.638403199026357 * Positive_electrode_SOC____ + 14.44245261961305)
        + (Positive_electrode_SOC____ >= 0.6665106367866339)
        * (Positive_electrode_SOC____ < 0.8822401369572627)
        * (-51.18228504157037 * Positive_electrode_SOC____ + 33.4672534828494)
        + (Positive_electrode_SOC____ >= 0.8822401369572627)
        * (-380.7259405286768 * Positive_electrode_SOC____ + 324.2038932331925)
    )


parameters = SubstitutionDict(
    {
        #######################################################################
        # Boilerplate values that PyBaMM requires but are not important here. #
        #######################################################################
        "Current function [A]": 0,
        "Positive electrode cation signed stoichiometry": -1.0,
        "Positive electrode OCP entropic change [V.K-1]": 0,
        "Positive electrode OCP entropic change partial derivative by SOC [V.K-1]": 0,
        "Negative electrode cation signed stoichiometry": -1.0,
        "Negative electrode OCP entropic change [V.K-1]": 0,
        "Negative electrode OCP entropic change partial derivative by SOC [V.K-1]": 0,
        "Number of electrodes connected in parallel to make a cell": 1,
        "Number of cells connected in series to make a battery": 1,
        #################
        # Placeholders. #
        #################
        "Negative electrode double-layer capacity [F.m-2]": 2e-3,
        "Positive electrode double-layer capacity [F.m-2]": 2e-3,
        # Based on EC:EMC 3:7 weight-% from Landesfeind2019.
        "Thermodynamic factor": 1.7,
        #########################
        # Geometric properties. #
        #########################
        # Circular cut-out with diameter 18 mm for the measurements.
        "Current collector perpendicular area [m2]": 2.5447e-4,
        ##################
        # Cell capacity. #
        ##################
        # Currently refers to the anode, even though it is oversized.
        # Note that it is directly used to calculate the maximum
        # lithiation of the negative electrode.
        "Nominal cell capacity [A.h]": 0.01202,
        "Negative electrode capacity [A.h]": 0.01202,
        ################
        # Temperature. #
        ################
        "Reference temperature [K]": 298.46,
        "Ambient temperature [K]": 298.46,
        "Initial temperature [K]": 298.46,
        ##############################
        # Reaction symmetry factors. #
        ##############################
        "Anodic symmetry factor at Graphite-SiOx": αₙₙ,
        "Cathodic symmetry factor at Graphite-SiOx": αₚₙ,
        "Anodic symmetry factor at NMC": αₙₚ,
        "Cathodic symmetry factor at NMC": αₚₚ,
        ##############################################################
        # Commonly used expressions for the Butler-Volmer prefactor. #
        ##############################################################
        "Negative electrode exchange-current density [A.m-2]": (
            4e-2  # graphite_exchange_prefactor
        ),
        "Positive electrode exchange-current density [A.m-2]": (nmc_exchange_prefactor),
        (
            "Negative electrode exchange-current density partial derivative "
            "by electrolyte concentration [A.m.mol-1]"
        ): graphite_exchange_prefactor_derivative,
        (
            "Positive electrode exchange-current density partial derivative "
            "by electrolyte concentration [A.m.mol-1]"
        ): nmc_exchange_prefactor_derivative,
        #######################################
        # Graphite-SiOx electrode parameters. #
        #######################################
        "Negative electrode thickness [m]": 88e-6,
        # Mean value of the range of possible porosity values.
        "Negative electrode porosity": 0.26,
        # Specific surface area from surface area (98 cm²) and volume (0.022 cm³)
        # measurements, then matched to a = 3 * (1 - ε) / R, would give 4.983e-6.
        "Negative particle radius [m]": 4.785e-6,
        "Negative electrode electrons in reaction": 1.0,
        "Negative electrode OCP [V]": (
            _18650_LG_3500_MJ1_Anode_GITT_dch_ohne_EIS_2320__extraction
        ),
        "Negative electrode OCP derivative by SOC [V]": (
            derivative__18650_LG_3500_MJ1_Anode_GITT_dch_ohne_EIS_2320__extraction
        ),
        # Lab report gave 4.6 +- 0.9.
        "Negative electrode tortuosity square": 1.55,
        "Negative electrode conductivity [S.m-1]": 1.4e-4,  # 215, adjusted to match highest frequency semicircle
        "Negative particle diffusivity [m2.s-1]": Negative_electrode_diffusivity__m2_s_1_,
        ####################################
        # NMC-830512 electrode properties. #
        ####################################
        "Positive electrode thickness [m]": 74e-6,
        # Mean value of the range of possible porosity values.
        "Positive electrode porosity": 0.23,
        "Positive particle radius [m]": 2.375e-6,
        "Positive electrode electrons in reaction": 1.0,
        # With no half-cell data yet, use this literature value for NMC-811 for the
        # parameterization of the negative electrode. It should have only a minor
        # influence, but grossly wrong values might introduce unnecessary noise.
        "Positive electrode OCP [V]": (
            _18650_LG_3500_MJ1_Cathode_GITT_ch_ohne_EIS_2327__extraction
        ),
        "Positive electrode OCP derivative by SOC [V]": (
            derivative__18650_LG_3500_MJ1_Cathode_GITT_ch_ohne_EIS_2327__extraction
        ),
        # Lab report gave 2.5 +- 0.1.
        "Positive electrode tortuosity square": 2.5,
        "Positive electrode conductivity [S.m-1]": 0.25,
        "Positive particle diffusivity [m2.s-1]": Positive_electrode_diffusivity__m2_s_1_,
        #################################################################
        # Separator (replaced by Whatman GF/A from El-Cell) parameters. #
        #################################################################
        "Separator thickness [m]": 260e-6,
        "Separator porosity": 0.93,
        "Separator Bruggeman coefficient (electrolyte)": 1.0,
        "Separator Bruggeman coefficient (electrode)": 1.0,
        ##################################################################################
        # Electrolyte parameters. 1 M LiPF 6 in EC:EMC:DMC (1:1:1 vol%) with 2 % wt. VC. #
        ##################################################################################
        "Typical electrolyte concentration [mol.m-3]": 1000.0,
        "Initial concentration in electrolyte [mol.m-3]": 1000.0,
        "Cation transference number": 0.226,
        "Electrolyte diffusivity [m2.s-1]": 2.5e-10,
        "Electrolyte conductivity [S.m-1]": 5.5e-3,  # 1.026, adjusted to match offset
        ###################
        # Voltage window. #
        ###################
        "Lower voltage cut-off [V]": 2.5,
        "Upper voltage cut-off [V]": 4.2,
        ####################################################################
        # SEI properties, mostly taken from Single2019 and Kolzenberg2020. #
        ####################################################################
        "Charge number of anion in electrolyte salt dissociation": -1,
        "Charge number of cation in electrolyte salt dissociation": 1,
        "Stoichiometry of anion in electrolyte salt dissociation": 1,
        "Stoichiometry of cation in electrolyte salt dissociation": 1,
        "Mass density of electrolyte [kg.m-3]": 1.5e3,  # Wikipedia, 20 °C
        "Mass density of cations in electrolyte [kg.m-3]": 68.53,  # Li+PF6-
        "Molar mass of electrolyte solvent [kg.mol-1]": 89.08e-3,
        "Solvent concentration [mol.m-3]": 13.17e3,
        "Partial molar volume of electrolyte solvent [m3.mol-1]": 75.93e-6,
        "Inital SEI thickness [m]": 2e-9,
        "Reference apparent SEI thickness [m]": 0.05e-9,
        "SEI tunneling length [m]": 2.05e-9,
        "SEI formation rate constant [A.m-2]": 7.04e-5,
        "SEI formation symmetry factor": 0.22,
        "SEI molar volume [m3.mol-1]": 1.078e-5,
        "SEI thickness [m]": 2e-7,
        "SEI ionic conductivity [S.m-1]": 2e-2,
        "SEI relative permittivity": 131,
        "SEI lithium reference potential [J.mol-1]": 17400,
        "Anion transference number in SEI": 1 - 0.063,  # t_plus is 0.063
        "SEI porosity": 0.08,
        "SEI Bruggeman coefficient": 4.54,
    },
    substitutions={
        ###########################################################
        # Scalings that are wholly dependent on other parameters. #
        ###########################################################
        "Typical current [A]": "Nominal cell capacity [A.h]",
        "Electrode height [m]": 0.06,
        "Electrode width [m]": 1.23494869661675,
        "Cell volume [m3]": cell_volume,
        ###############################################################
        # Given the cell capacity Q, we adjust the maximum lithiation #
        # of the electrode via Q = (1 - ε) * L * A * c_max * F.       #
        ###############################################################
        # From the lab report: 1460 mol/m³ Li in Graphite-SiOx at SOC 0,
        #                     32452 mol/m³ Li in Graphite-SiOx at SOC 100.
        # Composition is 96.5% graphite and 3.5% SiOx. With the assumption
        # that the SiOx does not contribute to the dynamics at the measured
        # SOCs, we assign the values to the graphite. Literature states a
        # similar value for it anyways: Ecker2015, Schmalstieg2018 (lliondb.com).
        "Maximum concentration in negative electrode [mol.m-3]": (
            negative_concentration_correction
        ),
        # The provided values give roughly 20000 mol/m³.
        "Maximum concentration in positive electrode [mol.m-3]": (
            positive_concentration
        ),
        # These are just placeholders until the parameterization routine
        # changes them.
        "Initial concentration in negative electrode [mol.m-3]": (
            placeholder_initial_negative_concentration
        ),
        "Initial concentration in positive electrode [mol.m-3]": (
            placeholder_initial_positive_concentration
        ),
        #########################################################
        # Active material as volume fraction of all components. #
        #########################################################
        "Negative electrode active material volume fraction": (
            negative_volume_fraction
        ),
        "Positive electrode active material volume fraction": (
            positive_volume_fraction
        ),
        #################################################################
        # Conversion from tortuosity τ in the lab report to Bruggeman.  #
        # The lab report uses the notation N_M = ε / τ                  #
        # instead of N_M = ε / τ² for the MacMullin number.             #
        # So we first take the square root of the value from there.     #
        # Formula with τ as the square root: β = 1 - 2 log(τ) / log(ε). #
        #################################################################
        "Negative electrode Bruggeman coefficient (electrolyte)": (negative_bruggeman),
        "Negative electrode Bruggeman coefficient (electrode)": (negative_bruggeman),
        "Positive electrode Bruggeman coefficient (electrolyte)": (positive_bruggeman),
        "Positive electrode Bruggeman coefficient (electrode)": (positive_bruggeman),
        #####################################################################
        # Match the particle radius as it is used in the derivation of the  #
        # model equations: just an effective parameter that scales with the #
        # active surface area to volume ratio a = 3 * (1 - ε) / R.          #
        # Note: do not calculate the particle radius here instead, as the   #
        # solver setup requires it to be known when building the model.     #
        #####################################################################
        # The provided values give around 226630 1/m.
        "Negative electrode surface area to volume ratio [m-1]": (
            negative_effective_surface_area
        ),
        # The provided values give around 460737 1/m.
        "Positive electrode surface area to volume ratio [m-1]": (
            positive_effective_surface_area
        ),
        ###################################################
        # PyBaMM names for the reaction symmetry factors. #
        ###################################################
        "Negative electrode anodic charge-transfer coefficient": (
            "Anodic symmetry factor at Graphite-SiOx"
        ),
        "Negative electrode cathodic charge-transfer coefficient": (
            "Cathodic symmetry factor at Graphite-SiOx"
        ),
        "Positive electrode anodic charge-transfer coefficient": (
            "Anodic symmetry factor at NMC"
        ),
        "Positive electrode cathodic charge-transfer coefficient": (
            "Cathodic symmetry factor at NMC"
        ),
        "Open-circuit voltage at 100% SOC [V]": "Upper voltage cut-off [V]",
        "Open-circuit voltage at 0% SOC [V]": "Lower voltage cut-off [V]",
    },
)


def get_parameters_with_switched_electrodes():
    original_parameters = deepcopy(parameters)
    switched_parameters = deepcopy(parameters)
    # Switch the parameters between negative and positive electrode.
    for k, v in original_parameters.items():
        if "negative" in k:
            switched_parameters[k.replace("negative", "positive")] = v
        elif "positive" in k:
            switched_parameters[k.replace("positive", "negative")] = v
        elif "Negative" in k:
            switched_parameters[k.replace("Negative", "Positive")] = v
        elif "Positive" in k:
            switched_parameters[k.replace("Positive", "Negative")] = v
    return switched_parameters
